"use strict";(self["webpackChunkbilibili_recording"]=self["webpackChunkbilibili_recording"]||[]).push([[499],{6499:function(e,s,l){l.r(s),l.d(s,{default:function(){return _}});var o=l(3396),t=l(7139),a=l(9242);const r={class:"mainContainer"},i=(0,o._)("div",{class:"video-container"},[(0,o._)("div",null,[(0,o._)("video",{id:"videoElement",class:"centeredVideo",controls:"",autoplay:""})])],-1),n={class:"controls"},h=["src","onClick"],c={class:"el-icon-user",style:{"font-size":"small"}},u={style:{"font-size":"small","padding-left":"20px"}},d={style:{color:"#909399"}};function m(e,s,l,m,p,g){const w=(0,o.up)("Search"),f=(0,o.up)("el-icon"),A=(0,o.up)("el-input"),v=(0,o.up)("el-col"),y=(0,o.up)("el-row"),C=(0,o.up)("el-tag"),P=(0,o.up)("Star"),T=(0,o.up)("el-avatar"),_=(0,o.up)("el-link"),k=(0,o.up)("el-space"),S=(0,o.up)("el-card"),b=(0,o.up)("el-pagination");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(y,{gutter:10},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{span:12},{default:(0,o.w5)((()=>[(0,o.Wm)(A,{modelValue:e.searchTitle,"onUpdate:modelValue":s[0]||(s[0]=s=>e.searchTitle=s),placeholder:"Search Title",clearable:"",onChange:s[1]||(s[1]=s=>e.searchRoomsWithTitle(e.searchTitle))},{append:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w)])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(v,{span:12},{default:(0,o.w5)((()=>[(0,o.Wm)(A,{modelValue:e.searchAnchor,"onUpdate:modelValue":s[2]||(s[2]=s=>e.searchAnchor=s),placeholder:"Search Anchor",clearable:"",onChange:s[3]||(s[3]=s=>e.searchRoomsWithAnchor(e.searchAnchor))},{append:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w)])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,o.Wm)(y,{gutter:10},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.areas,(s=>((0,o.wg)(),(0,o.j4)(v,{span:2,key:s},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{onClick:l=>e.onClickArea(s)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(s),1)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),e.showSubArea?((0,o.wg)(),(0,o.j4)(y,{key:0,gutter:10},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.subAreas,(s=>((0,o.wg)(),(0,o.j4)(v,{span:2,key:s},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{onClick:l=>e.onClickSubArea(s)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(s),1)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})):(0,o.kq)("",!0),(0,o.wy)((0,o._)("div",r,[(0,o.Wm)(y,{justify:"center"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(C,{round:"",effect:"light"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.liveTitle),1)])),_:1},512),[[a.F8,e.isShowTitle]])])),_:1}),i,(0,o._)("div",n,[(0,o._)("button",{onClick:s[4]||(s[4]=s=>e.flvPlayer.play())},"Start"),(0,o._)("button",{onClick:s[5]||(s[5]=s=>e.flvPlayer.pause())},"Pause"),(0,o._)("button",{onClick:s[6]||(s[6]=s=>e.flv_destroy())},"Destroy")])],512),[[a.F8,e.isShowLive]]),(0,o.Wm)(y,{gutter:5},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.showrooms,(s=>((0,o.wg)(),(0,o.j4)(v,{xs:16,sm:10,md:8,lg:5,xl:4,key:s.RoomID},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{shadow:"always",style:{"--el-card-padding":"10px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{direction:"vertical",alignment:"start"},{default:(0,o.w5)((()=>[(0,o._)("img",{src:s.LiveCover,style:{width:"256px",height:"144px"},class:"image",lazy:"",onClick:l=>e.watchLive(s)},null,8,h),(0,o._)("span",null,[(0,o._)("i",c,(0,t.zw)(s.Popularity),1),(0,o._)("span",u,(0,t.zw)(s.ParentName)+"-"+(0,t.zw)(s.AreaName),1)]),(0,o._)("div",null,(0,t.zw)(s.Title.slice(0,15)),1),(0,o._)("div",d,[(0,o._)("span",null,[(0,o._)("div",null,[(0,o.Wm)(P,{style:{width:"2em",height:"2em",position:"relative",top:"1px","padding-right":"4px"},onClick:l=>e.favorite(s)},null,8,["onClick"]),(0,o.Wm)(T,{size:"small",src:s.UserCover,onClick:l=>e.blockUser(s)},null,8,["src","onClick"]),(0,o.Wm)(_,{class:"anchor-name",href:e.uID2URL(s)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(s.Uname),1)])),_:2},1032,["href"])])])])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),(0,o.Wm)(b,{layout:"prev, pager, next","page-count":e.pages,"current-page":e.pageIndex,"onUpdate:currentPage":e.onCurrentChange},null,8,["page-count","current-page","onUpdate:currentPage"])],64)}var p=l(4870),g=l(2639),w=l(818),f=l(2748),A=l(1779),v=l(2747),y=l.n(v),C=(0,o.aZ)({setup(){},components:{Star:f.Star},data(){const e=(0,p.iH)(""),s=(0,p.iH)("");let l=[],o=[],t=[],a=[],r=[],i=!1;const n=30;let h=0,c=1,u=!1,d="",m={},g=!1,w="";return{searchTitle:e,searchAnchor:s,areas:l,subAreas:o,allrooms:t,arearooms:a,showrooms:r,showSubArea:i,perPageNum:n,pages:h,pageIndex:c,isShowLive:u,liveurl:d,flvPlayer:m,isShowTitle:g,liveTitle:w}},mounted(){this.getAreaInfo(!0),setInterval(this.getAreaInfo,1e3)},methods:{getAreaInfo(e=!1){fetch(`${g.ip}:${g.N}/areainfos`,{method:"get",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE,UPDATE","Access-Control-Allow-Headers":"Access-Control-Allow-Methods, Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers","Access-Control-Allow-Credentials":"true","Content-Type":"application/json; charset=utf-8"}}).then((e=>(e.ok||console.log("failed"),e.json()))).then((s=>{let l=[],o=[];for(let e in s)l.push(s[e]),-1===o.indexOf(s[e]["ParentName"])&&o.push(s[e]["ParentName"]);this.allrooms=l,this.areas=o,e&&(this.arearooms=l,this.showrooms=this.arearooms.slice(0,this.perPageNum),this.pages=1+(this.arearooms.length/this.perPageNum|0),this.pageIndex=1)}))},onClickArea(e){let s=[],l=[];for(let o in this.allrooms)this.allrooms[o]["ParentName"]===e&&(l.push(this.allrooms[o]),-1===s.indexOf(this.allrooms[o]["AreaName"])&&(s.push(this.allrooms[o]["AreaName"]),this.showSubArea=!0));this.arearooms=l,this.subAreas=s,this.showrooms=this.arearooms.slice(0,this.perPageNum),this.pages=1+(this.arearooms.length/this.perPageNum|0),this.pageIndex=1},onClickSubArea(e){let s=[];for(let l in this.allrooms)this.allrooms[l]["AreaName"]===e&&s.push(this.allrooms[l]);this.arearooms=s,this.showrooms=this.arearooms.slice(0,this.perPageNum),this.pages=1+(this.arearooms.length/this.perPageNum|0),this.pageIndex=1},onCurrentChange(e){this.showrooms=this.arearooms.slice((e-1)*this.perPageNum,e*this.perPageNum),this.pageIndex=e},uID2URL(e){return`https://space.bilibili.com/${e.UID}`},blockUser(e){fetch(`${g.ip}:${g.N}/blockroom`,{method:"post",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE,UPDATE","Access-Control-Allow-Headers":"Access-Control-Allow-Methods, Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers","Access-Control-Allow-Credentials":"true","Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({roomID:e.RoomID})}).then((e=>e.json())).then((e=>{console.log(e);let s="",l="",o="";e["msg"]?(s="success",l="Success",o="BLock user success"):(s="error",l="Failed",o="BLock user failed"),(0,w.bM)({title:l,message:o,type:s})})).catch((e=>{console.log(e)}))},favorite(e){A.Z.emit("addMonitorRoom",{RoomID:e.RoomID,Platform:"bilibili"})},searchRoomsWithTitle(e){let s=[];for(let l in this.allrooms)-1!==this.allrooms[l].Title.indexOf(e)&&s.push(this.allrooms[l]);this.arearooms=s,this.showrooms=this.arearooms.slice(0,this.perPageNum),this.pages=1+(this.arearooms.length/this.perPageNum|0),this.pageIndex=1},searchRoomsWithAnchor(e){let s=[];for(let l in this.allrooms)-1!==this.allrooms[l].Uname.indexOf(e)&&s.push(this.allrooms[l]);this.arearooms=s,this.showrooms=this.arearooms.slice(0,this.perPageNum),this.pages=1+(this.arearooms.length/this.perPageNum|0),this.pageIndex=1},watchLive(e){fetch(`${g.ip}:${g.N}/getliveurl`,{method:"post",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS, PUT, DELETE,UPDATE","Access-Control-Allow-Headers":"Access-Control-Allow-Methods, Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers","Access-Control-Allow-Credentials":"true","Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({roomID:e.RoomID,platform:"bilibili"})}).then((e=>e.json())).then((s=>{console.log(s),s["succ"]?(this.liveurl=s["liveurl"],this.videoPlayer(s["liveurl"]),this.isShowLive=!0,this.isShowTitle=!0,this.liveTitle=`${e.Uname}-${e.Title}`):(0,w.bM)({title:"直播流解析失败",type:"error"})})).catch((e=>{console.log(e)}))},videoPlayer(e){if(y().isSupported()){console.log(e);var s=document.getElementById("videoElement");this.isShowLive&&(this.flvPlayer.unload(),this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy()),console.log(e),this.flvPlayer=y().createPlayer({type:"flv",url:e,isLive:!0,cors:!0},{autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:12,autoCleanupMinBackwardDuration:8,enableStashBuffer:!1,lazyLoad:!1}),this.flvPlayer.attachMediaElement(s),this.flvPlayer.load(),this.flvPlayer.volume=.8,this.flvPlayer.on(y().Events.ERROR,((e,s,l)=>{console.log(e,s,l),this.isShowLive&&(this.flvPlayer.pause(),this.flvPlayer.unload(),this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy(),this.videoPlayer(this.liveurl))})),this.flvPlayer.play()}},flv_destroy(){this.flvPlayer.pause(),this.flvPlayer.unload(),this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy(),this.isShowLive=!1,this.isShowTitle=!1}}}),P=l(89);const T=(0,P.Z)(C,[["render",m]]);var _=T}}]);
//# sourceMappingURL=499.ce16db34.js.map